---
layout: default
---

{% include components/hero.html image="/assets/img/blog/default.webp"
title="Temp" %}

<div class="ship-estimator">
  <div class="row">
    <input id="se-country" placeholder="Country (US)" value="US">
    <!-- State: select for US, text for others -->
    <select id="se-state-us" style="display:block"></select>
    <input id="se-state" placeholder="State/Province" style="display:none">
    <input id="se-zip" placeholder="ZIP (10118)">
    <button id="se-check">Estimate shipping</button>
  </div>
  <div id="se-results"></div>
</div>

<script>
const US_STATES = [
  "AL","AK","AZ","AR","CA","CO","CT","DC","DE","FL","GA","HI","IA","ID","IL","IN","KS","KY","LA","MA","MD","ME","MI","MN","MO","MS","MT","NC","ND","NE","NH","NJ","NM","NV","NY","OH","OK","OR","PA","PR","RI","SC","SD","TN","TX","UT","VA","VI","VT","WA","WI","WV","WY"
];

(function setupEstimatorUI(){
  const countryEl = document.getElementById("se-country");
  const stateUsEl = document.getElementById("se-state-us");
  const stateTextEl = document.getElementById("se-state");
  const zipEl = document.getElementById("se-zip");

  // populate US states, default NY
  stateUsEl.innerHTML = US_STATES.map(s => `<option value="${s}">${s}</option>`).join("");
  stateUsEl.value = "NY";

  // restore saved addr if present
  try {
    const saved = JSON.parse(localStorage.getItem("shipAddr")||"null");
    if (saved) {
      if (saved.country) countryEl.value = saved.country.toUpperCase();
      if ((saved.country||"").toUpperCase() === "US") {
        stateUsEl.style.display = "block"; stateTextEl.style.display = "none";
        if (saved.state) stateUsEl.value = saved.state.toUpperCase();
      } else {
        stateUsEl.style.display = "none"; stateTextEl.style.display = "block";
        if (saved.state) stateTextEl.value = saved.state;
      }
      if (saved.zip) zipEl.value = saved.zip;
    }
  } catch {}

  function toggleStateInput(){
    const cc = (countryEl.value||"").trim().toUpperCase();
    if (cc === "US") {
      stateUsEl.style.display = "block";
      stateTextEl.style.display = "none";
    } else {
      stateUsEl.style.display = "none";
      stateTextEl.style.display = "block";
    }
  }
  countryEl.addEventListener("input", toggleStateInput);
  toggleStateInput(); // initial
})();

// hook into existing estimateShipping()
async function estimateShipping(variantId){
  const country = (document.getElementById("se-country").value||"US").trim().toUpperCase();
  const zip = document.getElementById("se-zip").value.trim();
  const state = country === "US"
      ? document.getElementById("se-state-us").value.trim().toUpperCase()
      : document.getElementById("se-state").value.trim();

  // persist for next visit
  localStorage.setItem("shipAddr", JSON.stringify({ country, state, zip }));

  const qs = new URLSearchParams({ country, state, zip, variant_id: String(variantId), qty: "1" });
  const res = await fetch(`${API}/rates-get?${qs.toString()}`);
  const data = await res.json();
  const box = document.getElementById("se-results");
  if (!Array.isArray(data)) { box.innerHTML = `<div class="error">Error: ${data.error||"Unknown"}</div>`; return; }
  box.innerHTML = data.map(r=>`
    <div class="rate">
      <div><strong>${r.name}</strong> ${r.isCarbonOffset?'ðŸŒ¿':''}<div class="sub">${r.deliveryWindow||''}</div></div>
      <div>${r.currency} $${Number(r.rate).toFixed(2)}</div>
    </div>`).join("");
}
</script>


<style>
.ship-estimator input, .ship-estimator select { flex:1 1 140px; padding:.5rem .6rem; border:1px solid #444; border-radius:.75rem; background:#222; color:#eee }
.ship-estimator button { padding:.55rem .9rem; border:0; border-radius:.75rem; background:#fff; color:#000; cursor:pointer }
.error { color:#ff6b6b; margin-top:.5rem }
</style>
